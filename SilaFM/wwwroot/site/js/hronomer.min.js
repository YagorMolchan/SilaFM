function strip_tags(n,t){var f="",e=!1,o=[],s=[],u="",i=0,h="",r="",c=function(n,t,i){return i.split(n).join(t)};t&&(s=t.match(/([a-zA-Z0-9]+)/gi));n+="";o=n.match(/(<\/?[\S][^>]*>)/gi);for(f in o)if(!isNaN(f)){r=o[f].toString();e=!1;for(h in s)if(u=s[h],i=-1,i!=0&&(i=r.toLowerCase().indexOf("<"+u+">")),i!=0&&(i=r.toLowerCase().indexOf("<"+u+" ")),i!=0&&(i=r.toLowerCase().indexOf("<\/"+u)),i==0){e=!0;break}e||(n=c(r,"",n))}return n}function calc(){calc_proces(strip_tags($("#edit").val()))}function max_value(n,t){document.getElementById(t).value>60&&(alert("Заначение не должно превышать "+n),document.getElementById(t).value=n)}function calc_sec(){var n="";n=isNaN(parseInt(document.getElementById("menu_time_min").value))?parseInt(document.getElementById("menu_time_sec").value):isNaN(parseInt(document.getElementById("menu_time_sec").value))?parseInt(document.getElementById("menu_time_min").value*60):parseInt(document.getElementById("menu_time_sec").value)+parseInt(document.getElementById("menu_time_min").value*60);isNaN(n)||(document.getElementById("time_limit").value=n)}function calc_min(){if(document.getElementById("wanted_time").checked=document.getElementById("time_limit").disabled?!1:!0,document.getElementById("wanted_time").checked){document.getElementById("menu_time_min").disabled=!1;document.getElementById("menu_time_sec").disabled=!1;var n=Math.floor(document.getElementById("time_limit").value/60),t=parseInt(document.getElementById("time_limit").value)-parseInt(n*60);document.getElementById("menu_time_min").value=isNaN(n)?0:n;document.getElementById("menu_time_sec").value=isNaN(t)?0:t}else document.getElementById("menu_time_min").value="",document.getElementById("menu_time_sec").value="",document.getElementById("menu_time_min").disabled=!0,document.getElementById("menu_time_sec").disabled=!0}function disable_time(){document.getElementById("wanted_time").checked?(document.getElementById("menu_time_min").disabled=!1,document.getElementById("menu_time_sec").disabled=!1):(document.getElementById("menu_time_min").value="",document.getElementById("menu_time_sec").value="",document.getElementById("menu_time_min").disabled=!0,document.getElementById("menu_time_sec").disabled=!0,document.getElementById("time_limit").value="")}function calcDigit(n){var o;n=n.split("");var u=0,r=0,f=0,e=0,i=n.length/2,t=[];for(f=n.length-Math.floor(n.length/3)*3,s=0;s<=Math.ceil(n.length/3);s++)t[s]="";for(ele=0;ele<n.length;ele++)u==f&&(r++,u=0,f=3),n[ele]=="0"&&(i-=.5),t[r]+=n[ele].split(""),u++;for(t[r]=t[r].split(""),n.length<=3&&t.splice(1,1),con=0;con<t.length;con++){for(o=0,cons=0;cons<=t[con].length;cons++)t[con][cons]=="0"&&o++;o==3&&e++;t[con].length==3&&t.length>1&&(i+=.5);t[con].length==3&&t[con][1]=="1"&&(i-=.5);t[con].length==2&&t[con][0]=="1"&&(i-=.5)}return e>1&&(i-=.5*(e-1)),i}function countDigit(n){n=n.split("");var t=0,i=0;for(string=[],string[0]="",ip=0;ip<n.length;ip++)n[ip]=="-"?(t+=calcDigit(string[0]),t-=.5,string[0]=""):n[ip]==","||n[ip]=="."?(i++,string[1]=""):n[ip]=="%"?t+=.5:string[i]+=n[ip];return t+(isNaN(string[1])?calcDigit(string[0]):calcDigit(string[0])+calcDigit(string[1])+1)}function isNumber(n){return/^-?((\d+\.?\d?)|(\.\d+))$/.test(n)}function calc_proces(n){var h,f,d,l,o,e;updateStats();disable_time();var r=n,y=document.getElementById("total"),p=document.getElementById("total2"),g=document.getElementById("line"),nt=document.getElementById("line_red"),s=document.getElementById("time_limit"),w=document.getElementById("spare"),b=document.getElementById("free"),k=0;r=r.replace(/\&nbsp;/gi," ");r=r.replace(/<br>|\n/gi," <br> ");r=r.replace(/ <br> <br> /gi," <br> ");r=r.replace('<font color="red">',"");r=r.replace("<FONT color=red>","");r=r.replace("<\/font>","");r=r.replace("<\/FONT>","");r=r.replace("(","");r=r.replace(")","");var i=r.split(" "),t=0,v=0,a="",h,u=0;for(el=0;el<i.length;el++){if(i[el]=="<br>"){a+=a==""?i[el]:" "+i[el];continue}for((i[el].indexOf("$")!=-1||i[el].indexOf("&")!=-1||i[el]=="%"||i[el].indexOf("№")!=-1)&&(t+=.5),i[el].indexOf("...")!=-1&&i[el].length>3&&(t+=1),i[el].indexOf("...")!=-1&&i[el].length==3&&(t+=.5),a+=a==""?i[el]:" "+i[el],i[el]=i[el].replace(/\ /g,""),h=i[el].split(""),f=!0,c=0;c<i[el].length;c++)i[el].lastIndexOf("-")!=-1?isNumber(h[c])&&(t+=.5,f=!1):f=!0,h[c]=="-"&&h.length>2&&c!=0&&f==!0&&(t+=.5),h[c]==" "&&h.length>2&&subst.splice(c,1);isNumber(i[el])?t+=countDigit(i[el].toString()):i[el].length>2&&i[el].length<=14&&f==!0?t+=.5:i[el].length>14&&f==!0?t+=1:i[el].length==2&&f==!0?v+=2:v>5&&f==!0&&(t+=.5,v=0)}t*1>s.value&&s.value>0&&(u=(t-s.value)*2,k=1);document.getElementById("count_words").value=t*2;t=t.toFixed(0);t<0&&(t=0);r==""&&(t="0");duration2=Math.round(parseFloat(t)/10+parseFloat(t));text_data[text_data.length]=a;d=document.getElementById("edit");tot1=Math.round(parseFloat(t)-parseFloat(t)/10);tot2=parseFloat(t)+1;y.value=Math.round(tot1+tot1*.1)+unit;p.value=Math.round(tot2+tot1*.1)+unit;s.value&&s.value!=0?(document.getElementById("user_time").style.display="block",document.getElementById("min_hro").style.display="none",document.getElementById("total").style.display="none",document.getElementById("comf").innerHTML="Хронометраж:",l=s.value,parseInt(t)>parseInt(l)&&(document.getElementById("hrono_normal").style.color="red",document.getElementById("hrono_normal").innerHTML="Хронометраж превышен"),parseInt(t)==parseInt(l)&&(document.getElementById("hrono_normal").style.color="green",document.getElementById("hrono_normal").innerHTML="Хронометраж оптимален"),parseInt(t)<parseInt(l)&&(document.getElementById("hrono_normal").style.color="red",document.getElementById("hrono_normal").innerHTML="Хронометраж занижен"),document.getElementById("user_time").innerHTML=+l+" сек."):(document.getElementById("hrono_normal").style.color="green",document.getElementById("hrono_normal").innerHTML=" ",document.getElementById("min_hro").style.display="block",document.getElementById("comf").style.display="block",document.getElementById("comf").innerHTML="Оптимальный хронометраж:",document.getElementById("total").style.display="inline",document.getElementById("user_time").style.display="none",document.getElementById("free_words_div").style.display="none",document.getElementById("sp_words_div").style.display="none");u>0?(e=" лишних слов",(u==1||u==21)&&(e=" лишнее слово"),u>1&&u<5&&(e=" лишних слова"),w.innerHTML=u+e,u>0?(document.getElementById("sp_words_div").style.display="block",document.getElementById("free_words_div").style.display="none"):document.getElementById("sp_words_div").style.display="none"):(o=(parseFloat(l)-parseFloat(t))*2,e=" слов",(o==1||o==21)&&(e=" слово"),o>1&&o<5&&(e=" слова"),b.innerHTML=o+e,o>0?(document.getElementById("free_words_div").style.display="block",document.getElementById("sp_words_div").style.display="none"):(document.getElementById("free_words_div").style.display="none",document.getElementById("sp_words_div").style.display="none"))}function Start(){}function preview(){text_data.length>nextprev_text&&nextprev_text++;$("#edit").val(text_data[text_data.length-Math.abs(nextprev_text)])}function next(){nextprev_text>1&&nextprev_text--;$("#edit").val(text_data[text_data.length-Math.abs(nextprev_text)])}function updateStats(){}var iF;$(document).ready(function(){Start();calc_min()});var unit=" сек.",text_data=[],nextprev_text=1,data_string="";